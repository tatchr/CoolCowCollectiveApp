<topbar title="Milk sales" [backbtn]="true" backUrl="/tabs/sales-menu"></topbar>
<ion-row>
  <ion-col>
    <ion-item (click)="openFromDatePicker()">
      <ion-label position="floating" color="medium">From</ion-label>
      <ion-input [(ngModel)]="this.milkSalesService.selectedFromDate" readonly></ion-input>
    </ion-item>
  </ion-col>
  <ion-col>
    <ion-item (click)="openToDatePicker()">
      <ion-label position="floating" color="medium">To</ion-label>
      <ion-input [(ngModel)]="this.milkSalesService.selectedToDate" readonly item-center></ion-input>
    </ion-item>
  </ion-col>
</ion-row>
<ion-row>
  <ion-col>
    <ion-item class="ion-no-padding">
      <div class="scroll-container">
        <div class="scroll" scrollX="true">
          <ion-button *ngFor='let period of this.milkSalesService.datePicker.periods;' size="default" fill="outline"
            [color]="period.value == this.milkSalesService.selectedPeriod ? 'success' : 'medium'"
            (click)="this.milkSalesService.periodSelected(period.value)">
            {{period.label}}</ion-button>
        </div>
      </div>
    </ion-item>
  </ion-col>
</ion-row>
<ion-row>
  <ion-col>
    <ion-button color="success" expand="full" routerLink="/milk-sales-input/" routerDirection="forward">New sale
    </ion-button>
  </ion-col>
</ion-row>

<ion-content no-padding>
  <div *ngFor='let result of this.milkSalesService.milkSalesList | groupmilksalesbydate:this.milkSalesService.changeCounter'>
    <ion-item-divider class="dateLbl" sticky="true">
      <ion-label>
        {{result.date | date: 'yyyy-MM-dd'}}
      </ion-label>
    </ion-item-divider>
    <ion-row *ngFor='let sale of result.milkSalesList' class="product-list">
      <ion-col [size]="!sale.fullAmountPaid ? '9' : '12'" no-padding>
        <ion-item button="true" (click)="openMilkSaleRecord(sale)" 
            [color]="sale.fullAmountPaid ? 'success' : ''">
          <ion-label>
            <p style="font-size: 12px;">{{sale.offtaker}}</p>
            <p>
              <b>{{ sale.pricePerLiter * sale.litersSold}} Ksh</b> ({{sale.litersSold}}L @ {{sale.pricePerLiter}} Ksh)
            </p>
          </ion-label>
        </ion-item>
      </ion-col>

      <ion-col *ngIf="!sale.fullAmountPaid" size="3" no-padding align-self-stretch>
        <ion-button size="small" fill="outline" class="toggle-btn" color="success" (click)="moneyReceived(sale)">          
            <ion-icon name="logo-usd" style="font-size:20px;"></ion-icon>               
        </ion-button>
      </ion-col>
    </ion-row>
  </div>  
</ion-content>

<ion-footer>
  <ion-row style="padding-left: 10px;">
    <ion-col size="2" class="ion-text-center" no-padding>
      <ion-label>
        <p>Sales</p>
        <p>{{this.milkSalesService.milkSalesList.length}}</p>
      </ion-label>
    </ion-col>
    <ion-col size="2" class="ion-text-center" no-padding>
      <ion-label>
        <p>Milk</p>
        <p>{{this.milkSalesService.totalLiters}}L</p>
      </ion-label>
    </ion-col>
    <ion-col size="3" class="ion-text-center" no-padding>
      <ion-label>
        <p>Money</p>
        <p>{{this.milkSalesService.totalMoney}} Ksh</p>
      </ion-label>
    </ion-col>
    <ion-col size="5" class="ion-text-center" no-padding>
      <ion-label>
        <p>Money received</p>
        <p>{{this.milkSalesService.totalMoneyReceived}} Ksh</p>
      </ion-label>
    </ion-col>
  </ion-row>
</ion-footer>