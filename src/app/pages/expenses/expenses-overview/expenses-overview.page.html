<ion-header>
  <ion-toolbar color="success">
    <ion-title>Expenses</ion-title>
  </ion-toolbar>
</ion-header>

<ion-row>
  <ion-col>
    <ion-item (click)="openFromDatePicker()">
      <ion-label position="floating" color="medium">From</ion-label>
      <ion-input [(ngModel)]="this.expensesService.selectedFromDate" readonly></ion-input>
    </ion-item>
  </ion-col>
  <ion-col>
    <ion-item (click)="openToDatePicker()">
      <ion-label position="floating" color="medium">To</ion-label>
      <ion-input [(ngModel)]="this.expensesService.selectedToDate" readonly item-center></ion-input>
    </ion-item>
  </ion-col>
</ion-row>
<ion-row>
  <ion-col>
    <ion-item>
      <div class="scroll-container">
        <div class="scroll" scrollX="true">
          <ion-button *ngFor='let period of this.expensesService.datePicker.periods;' size="default" fill="outline"
            [color]="period.value == this.expensesService.selectedPeriod ? 'success' : 'medium'"
            (click)="this.expensesService.periodSelected(period.value)">
            {{period.label}}</ion-button>
        </div>
      </div>
    </ion-item>
  </ion-col>
</ion-row>
<ion-row>
  <ion-col>
    <ion-button color="success" expand="full" routerLink="/expenses-input/" routerDirection="forward">New expense
    </ion-button>
  </ion-col>
</ion-row>

<ion-content padding>
  <ion-grid>
    <ion-list *ngFor="let expense of this.expensesService.nonRecurringExpensesList; let i = index;">
      <ion-item tappable button="true" (click)="openExpenseRecord(expense)">
        <ion-note slot="end" style="font-size: 16px;">{{expense.totalPrice}} Ksh </ion-note>
        <ion-label>
          <p>{{expense.date | date: 'yyyy-MM-dd'}}</p>
          <p style="font-size: 12px;">{{expense.type}}</p>
          <p>
            <b>({{expense.quantity}}
              {{expense.quantityUnit == null || expense.quantityUnit == 'units' 
              ? 'x' 
              : expense.quantityUnit}}) </b>
            {{expense.itemBought}} @ {{expense.price}} Ksh
          </p>
        </ion-label>
      </ion-item>
    </ion-list>

    <ion-row>
      <ion-col>
        Recurring expenses
      </ion-col>
    </ion-row>

    <ion-list *ngFor='let expenseGroup of this.expensesService.recurringExpensesList; let i = index;'
      class="accordion-list" detail="false" no-padding>

      <ion-item-sliding *ngIf="expenseGroup.expensesList.length > 0">
        <ion-item-options side="start">
          <ion-item-option color="medium" expandable>
            <ion-icon name="cog" style="font-size: 1.25em;"></ion-icon>
          </ion-item-option>
        </ion-item-options>

        <ion-item tappable [ngClass]="{'section-active': expenseGroup.open, 'section': !expenseGroup.open}" no-padding>
          <ion-col size="2" align-self-stretch no-padding>
            <ion-button (click)="toggleSection(i)" class="toggle-btn" fill="clear">
              <ion-icon style="font-size: 16px;padding-right: 6px;" name="arrow-round-forward" *ngIf="!expenseGroup.open">
              </ion-icon>
              <ion-icon style="font-size: 16px;padding-right: 6px;" name="arrow-round-down" *ngIf="expenseGroup.open">
              </ion-icon>
            </ion-button>
          </ion-col>
          
          <ion-col size="7" align-self-center>            
            <ion-label>
              {{expenseGroup.rootExpense.itemBought}}
            </ion-label>
            <ion-label *ngIf="expenseGroup.open">
              {{expenseGroup.totalPrice}} Ksh
            </ion-label>
          </ion-col>

          <ion-col size="3" *ngIf="!expenseGroup.open" align-self-center class="ion-text-end">
            <ion-note style="font-size: 16px;">{{expenseGroup.totalPrice}} Ksh </ion-note>
          </ion-col>

          <ion-col size="3" *ngIf="expenseGroup.open" align-self-stretch class="ion-text-end" no-padding class="toggle-btn">
            <ion-button class="toggle-btn" color="primary" expand="full" (click)="openRecurringExpenseRootRecord(expenseGroup.rootExpense)">
              <ion-icon name="cog"></ion-icon>
            </ion-button>
          </ion-col>
      </ion-item>

      </ion-item-sliding>
      

      <div *ngIf="expenseGroup.expensesList && expenseGroup.open">
        <ion-list class="child-list" *ngFor='let childExpense of expenseGroup.expensesList'>
          <ion-item button="true" (click)="openExpenseRecord(childExpense)">
            <ion-note slot="end" style="font-size: 16px;">{{childExpense.totalPrice}} Ksh </ion-note>
            <ion-label>
              <p>{{childExpense.date | date: 'yyyy-MM-dd'}}</p>
              <p style="font-size: 12px;">{{childExpense.type}}</p>
              <p>
                <b>({{childExpense.quantity}}
                  {{childExpense.quantityUnit == null || childExpense.quantityUnit == 'units' 
                  ? 'x' 
                  : childExpense.quantityUnit}}) </b>
                {{childExpense.itemBought}} @ {{childExpense.price}} Ksh</p>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>
    </ion-list>


  </ion-grid>

</ion-content>